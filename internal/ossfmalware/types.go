package ossfmalware

import "time"

// OSVEntry represents the OSV format malware entry
// Reference: https://ossf.github.io/osv-schema/
type OSVEntry struct {
	ID             string     `json:"id"`
	Modified       time.Time  `json:"modified"`
	Published      time.Time  `json:"published"`
	SchemaVersion  string     `json:"schema_version"`
	Summary        string     `json:"summary"`
	Details        string     `json:"details"`
	Affected       []Affected `json:"affected"`
	DatabaseSpecific map[string]interface{} `json:"database_specific,omitempty"`
}

// Affected represents the affected package information
type Affected struct {
	Package Package  `json:"package"`
	Ranges  []Range  `json:"ranges,omitempty"`
	Versions []string `json:"versions,omitempty"`
}

// Package represents package information
type Package struct {
	Ecosystem string `json:"ecosystem"`
	Name      string `json:"name"`
}

// Range represents version range information
type Range struct {
	Type   string  `json:"type"` // "SEMVER", "ECOSYSTEM", "GIT"
	Events []Event `json:"events"`
}

// Event represents a range event (introduced/fixed)
type Event struct {
	Introduced string `json:"introduced,omitempty"`
	Fixed      string `json:"fixed,omitempty"`
	LastAffected string `json:"last_affected,omitempty"`
	Limit      string `json:"limit,omitempty"`
}

// MalwareFinding represents a lightweight finding for index storage
type MalwareFinding struct {
	ID      string `json:"id"`       // e.g., "MAL-2025-32615"
	Summary string `json:"summary"`  // Short description
	Source  string `json:"source"`   // "ossf-malicious-packages"
}

// PackageVersions maps version strings to malware findings
type PackageVersions map[string][]MalwareFinding

// SyncMetadata stores sync-related metadata
type SyncMetadata struct {
	LastSHA   string    `json:"last_sha"`
	LastSync  time.Time `json:"last_sync"`
	EntryCount int      `json:"entry_count"`
}
